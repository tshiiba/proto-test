syntax = "proto3";

package sogage.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

// 共通のエラーコード。
enum ErrorCode {
  ERROR_CODE_UNSPECIFIED = 0;
  ERROR_CODE_UNKNOWN = 1;
  ERROR_CODE_INVALID_ARGUMENT = 2;
  ERROR_CODE_UNAUTHENTICATED = 3;
  ERROR_CODE_FORBIDDEN = 4;
  ERROR_CODE_NOT_FOUND = 5;
  ERROR_CODE_CONFLICT = 6;
  ERROR_CODE_RATE_LIMITED = 7;
  ERROR_CODE_INSUFFICIENT_FUNDS = 8;
  ERROR_CODE_MAINTENANCE = 9;
}

// クライアントプラットフォーム。
enum Platform {
  PLATFORM_UNSPECIFIED = 0;
  PLATFORM_IOS = 1;
  PLATFORM_ANDROID = 2;
  PLATFORM_WEB = 3;
}

// 代表的な通貨種別。
enum CurrencyType {
  CURRENCY_TYPE_UNSPECIFIED = 0;
  CURRENCY_TYPE_GOLD = 1;
  CURRENCY_TYPE_GEMS_FREE = 2;
  CURRENCY_TYPE_GEMS_PAID = 3;
  CURRENCY_TYPE_STAMINA = 4;
}

// レアリティ例。
enum ItemRarity {
  ITEM_RARITY_UNSPECIFIED = 0;
  ITEM_RARITY_N = 1;
  ITEM_RARITY_R = 2;
  ITEM_RARITY_SR = 3;
  ITEM_RARITY_SSR = 4;
  ITEM_RARITY_UR = 5;
}

// 課金ストア種別。
enum StoreType {
  STORE_TYPE_UNSPECIFIED = 0;
  STORE_TYPE_APP_STORE = 1;
  STORE_TYPE_GOOGLE_PLAY = 2;
  STORE_TYPE_DMM = 3;
}

// 連携できる代表的な外部IDプロバイダ。
// Cognito User Pool の「Federation」(Apple / Google) を想定。
enum IdentityProvider {
  IDENTITY_PROVIDER_UNSPECIFIED = 0;
  IDENTITY_PROVIDER_APPLE = 1;
  IDENTITY_PROVIDER_GOOGLE = 2;
}

message ApiError {
  ErrorCode code = 1;
  string message = 2;
  // 例: {"field": "gacha_id", "reason": "not_found"}
  map<string, string> details = 3;
}

message ResponseMeta {
  string request_id = 1;
  google.protobuf.Timestamp server_time = 2;
  ApiError error = 3;
}

message DeviceInfo {
  Platform platform = 1;
  string device_model = 2;
  string os_version = 3;
  string app_version = 4;
  map<string, string> extra = 5;
}

message PlayerProfile {
  string player_id = 1;
  string name = 2;
  int32 level = 3;
  int32 exp = 4;

  int32 stamina = 10;
  int32 stamina_max = 11;

  google.protobuf.Timestamp created_at = 20;

  // key: 任意（"gold", "gems_free" など）
  map<string, int64> currencies = 30;

  repeated string unlocked_feature_flags = 40;
}

message Deck {
  string deck_id = 1;
  repeated DeckUnit units = 2;
}

message DeckUnit {
  string unit_id = 1;
  int32 position = 2;
  int32 level = 3;
  ItemRarity rarity = 4;
  repeated string equipped_item_ids = 5;
}

message Pagination {
  int32 page_size = 1;
  string page_token = 2;
}

// 付与アイテムの例。
message Reward {
  oneof reward {
    CurrencyReward currency = 1;
    ItemReward item = 2;
  }
}

message CurrencyReward {
  CurrencyType type = 1;
  int64 amount = 2;
}

message ItemReward {
  string item_id = 1;
  int64 amount = 2;
  ItemRarity rarity = 3;
  // 表示用（存在しない場合もある）
  google.protobuf.StringValue display_name = 4;
}

// アカウント連携状態（引継ぎ設定）を表す。
message LinkedIdentity {
  IdentityProvider provider = 1;

  // 例: Cognito 側の subject / provider user id。
  // クライアント表示に不要な場合は空にして良い。
  google.protobuf.StringValue subject = 2;

  google.protobuf.Timestamp linked_at = 3;
}
